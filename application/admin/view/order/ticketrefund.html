<!--{extend name="index_layout"/}-->
{block name="main"}
<div class="layui-card layui-form">
    <form class="layui-form">
        <div class="layui-form-item" style="padding-top:15px;">
            <label class="layui-form-label">卡卷类型</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.card.type}
            </div>
            <label class="layui-form-label">使用月份</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.months?$data.months:"次卡"}
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">激活时间</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.start}
            </div>
            <label class="layui-form-label">到期时间</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.end}
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">支付金额</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.real_price}元
            </div>
            <label class="layui-form-label">使用金额</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.card.money}元
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">退货原因</label>
            <div class="layui-input-block" style="width:190px">
              <select name="reason" lay-verify="required" lay-filter="reason">
                <option value="商品品质问题" >商品品质问题 </option>
                <option value="商品不一致，客户退货">商品不一致，客户退货 </option>
                <option value="其他">其他</option>}
              </select>
            </div>
            <div id="reason">
            </div>
        </div>
        <div class="layui-form">
            <div class="layui-form-item" style="margin-left:40px;">
                <span style="font-weight:bold">退款金额</span><span class="refund_price" style="color:red;padding-left:20px;padding-right:20px; font-size:20px;font-weight:bold">{$data.card.balance}</span>元
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="font-weight:bold">退款方式</label>
                <div class="layui-input-block">
                  <input type="radio" name="type" value="cash" title="现金退款" checked="">
                  <input type="radio" name="type" value="balance" title="余额退款">
                  <input type="radio" name="type" value="card" title="银行卡">
                </div>
            </div>

        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block" style="width:200px;padding-bottom:15px;">
              <textarea name="remarks" placeholder="请输入内容" class="layui-textarea" style="resize:none"></textarea>
            </div>
        </div>
        <div style="float:right;margin-right:20px;margin-bottom:10px">
            <button type="button" class="layui-btn  layui-btn-normal" lay-submit lay-filter="close">关闭</button>
            <button type="button" class="layui-btn  layui-btn-danger" lay-submit lay-filter="confirm" id="confirm">确认退货</button>
        </div>
    </form>
</div>
{/block}
{block name="script" }
<script type="text/javascript" src="__STATIC__/admin/js/common.js"></script>
<script>
    layui.use(["table","layer","form"], function(){
    var table = layui.table,
        layer = layui.layer,
        form  = layui.form,
        $ = layui.$;
        var moneyArray = 0;
         form.on('submit(confirm)', function(data){
            var ticket = {$data.id};
            var field = data.field
            /*$("#confirm").hide();*/
            $.ajax({
                url:'{:url("admin/order/ticketrefund")}',
                type:"post",
                data:{id:ticket,data:field},
                success:function(datas){
                    
                    if(datas.result){
                        layer.msg(datas.msg, {icon: 6 , time: 1200 ,shade:0.6},function(){
                            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                            parent.layer.close(index); //再执行关闭
                        });

                    }else{
                        layer.msg(datas.msg, {icon: 5 , time: 2000 ,shade:0.6});
                        $("#confirm").show();
                    }
                }
            })
            return false;
        })
        form.on('submit(close)', function(data){
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭
        })
        
        form.on('select(reason)', function(data){
            //console.log(data.elem); //得到select原始DOM对象
            //console.log(data.value); //得到被选中的值
            //console.log(data.othis); //得到美化后的DOM对象
            var value = data.value;
            var text = `<div class="layui-input-block" style="width:200px;margin-top:10px;">
                <textarea name="reasons" placeholder="请输入内容" class="layui-textarea" style="resize:none"></textarea>
            </div>`;
            $("#reason").empty();
            if(value==="其他"){
                $("#reason").append(text);
                return false;
            }
        });
    });
</script>
{/block}
