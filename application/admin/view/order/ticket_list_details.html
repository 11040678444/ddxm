<!--{extend name="index_layout"/}-->
{block name="main"}
<div class="layui-card layui-form">
    <form class="layui-form">
        <div class="layui-form-item" style="padding-top:15px;">
            <label class="layui-form-label">订单编号</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.o_sn}
            </div>
            <label class="layui-form-label">退单编号</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.r_sn}
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">卡卷类型</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.type_text}
            </div>
            <label class="layui-form-label">使用月份</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.ticket.months?$data.ticket.months:"次卡"}
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">激活时间</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.ticket.start}
            </div>
            <label class="layui-form-label">到期时间</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.ticket.end}
            </div>
        </div>
        
        <div class="layui-form-item">
            <label class="layui-form-label">支付金额</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.ticket.real_price}元
            </div>
            <label class="layui-form-label" style="font-weight:bold">退款金额</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                <span class="refund_price" style="color:red;padding-left:20px;padding-right:20px; font-size:20px;font-weight:bold">{$data.r_amount}</span>元
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">申请人员</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.ticket.waiter}
            </div>
            <label class="layui-form-label">申请时间</label>
            <div class="layui-form-mid layui-word-aux ddxm-col">
                {$data.ticket.create_time}
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">退货原因</label>
            <div class="layui-input-block" >
                <div class="layui-form-mid layui-word-aux ddxm-col">
                    {$data.reason?$data.reason:"用户很懒 什么都没留下"}
                </div>
            </div>
        </div>
        <div class="layui-form">
            <div class="layui-form-item">
                <label class="layui-form-label" style="font-weight:bold">退款方式</label>
                <div class="layui-form-mid layui-word-aux ddxm-col">
                    {$data.otype==1?"现金退款":($data.otype==2?"余额退款":'银行卡退款')}
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="font-weight:bold">退款状态</label>
                <div class="layui-form-mid layui-word-aux ddxm-col">
                    {$data.r_status==0?"申请中":($data.r_status==1?"已完成":'已取消')}
                </div>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block" style="width:200px;padding-bottom:15px;">
              <textarea placeholder="这家伙很懒什么都没留下" readonly  class="layui-textarea" style="resize:none" >{$data.remarks}</textarea>
            </div>
        </div>
        <div style="float:right;margin-right:20px;margin-bottom:10px">
            <button type="button" class="layui-btn  layui-btn-normal" lay-submit lay-filter="close">关闭</button>
            {if condition = "$data['status'] eq 0"}
            <button type="button" class="layui-btn  layui-btn-danger" lay-submit lay-filter="confirm" id="confirm">确认退货</button>
            {/if}
        </div>
    </form>
</div>
{/block}
{block name="script" }
<script type="text/javascript" src="__STATIC__/admin/js/common.js"></script>
<script>
    layui.use(["table","layer","form"], function(){
    var table = layui.table,
        layer = layui.layer,
        form  = layui.form,
        $ = layui.$;
        var moneyArray = 0;
         form.on('submit(confirm)', function(data){
            var ticket = {$data.ticket.id};
            $.ajax({
                url:'{:url("admin/order/ticketrefund")}',
                type:"post",
                data:{id:ticket},
                success:function(datas){
                    if(datas.result){
                        layer.msg(datas.msg, {icon: 6 , time: 1200 ,shade:0.6},function(){
                            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                            parent.layer.close(index); //再执行关闭
                        });

                    }else{
                        layer.msg(data.msg, {icon: 5 , time: 2000 ,shade:0.6});
                        $("#confirm").show();
                    }
                }
            })
            return false;
        })
        form.on('submit(close)', function(data){
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭
        })
        
        form.on('select(reason)', function(data){
            //console.log(data.elem); //得到select原始DOM对象
            //console.log(data.value); //得到被选中的值
            //console.log(data.othis); //得到美化后的DOM对象
            var value = data.value;
            var text = `<div class="layui-input-block" style="width:200px;margin-top:10px;">
                <textarea name="reasons" placeholder="请输入内容" class="layui-textarea" style="resize:none"></textarea>
            </div>`;
            $("#reason").empty();
            if(value==="其他"){
                $("#reason").append(text);
                return false;
            }
        });
    });
</script>
{/block}
