{extend name="index_layout"/}
{block name="main"}
<div class="layui-card">
    <div class="layui-card-header">编辑股东</div>
    <div class="layui-card-body">
        <form class="layui-form form-horizontal">    <!-- action="{:url('admin/Member/level_doPost')}" method="post" -->
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red;">*</span>模板名称 </label>
                <div class="layui-input-inline w300">
                    <input type="text" name="title" required lay-verify="required"  autocomplete="title"  placeholder="模板名称" value="{$list['title']}" class="layui-input" >
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">选择地区 <span class="must">*</span></label>
                <div class="layui-input-block">
                    <input type="checkbox" value="1" lay-skin="primary" title="所有地区" lay-filter="c_all" >
                </div>
                <div class="layui-input-block">
                    {volist name="area" id="vo"}
                    <input type="checkbox" <?php for($i=0;$i<count($list['area_ids']);$i++){if( $list['area_ids'][$i] == $vo['id'] ){ echo "checked='checked'"; }} ?> name="area_ids[]" lay-skin="primary" title="{$vo.area_name}" class="shop_id" value="{$vo.id}" data="{$vo.id}">
                    {/volist}
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">运费类型</label>
                <div class="layui-input-block">
                    <input type="radio" {if condition="$list['type'] eq 1"} checked {/if} {if condition="!isset($list['type'])"}  checked {/if} name="type" value="1" title="按重量" lay-filter="jiedian">
                    <input type="radio" {if condition="$list['type'] eq 2"} checked {/if}  name="type" value="2" title="按体积" lay-filter="jiedian">
                    <input type="radio" {if condition="$list['type'] eq 3"} checked {/if}  name="type" value="3" title="按件数" lay-filter="jiedian">
                </div>
            </div>

            <div id="xianshi">

            </div>
            <input type="hidden" name="id" value="{$list['id']}">
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="L_submit">立即提交</button>
                    <button class="layui-btn layui-btn-normal" id = "close">返回</button>
                </div>
            </div>
        </form>
    </div>
</div>
{/block}
{block name="script"}
<script type="text/javascript" src="__STATIC__/admin/js/common.js"></script>
<script type="text/javascript" src="__STATIC__/admin/js/ticket.js"></script>
<script>

    function add_dom(type = 1){
        if( type == 1 ){
            var first = '首重/kg';
            first_price = '首重金额';
            first_price_pl = '首重金额 元/kg';
            add = '续重/kg';
            add_price = "续重金额";
            add_price_pl = "续重金额 元/kg ";
        }else if( type == 2 ){
            var first = '首立方m³';
            first_price = '首立方金额';
            first_price_pl = '首立方金额 元/m³';
            add = '续立方';
            add_price = "续立方金额";
            add_price_pl = "续立方金额 元/m³ ";
        }else{
            var first = '首件';
            first_price = '首件金额';
            first_price_pl = '首件金额 元/件';
            add = '续件';
            add_price = "续件金额";
            add_price_pl = "续件金额 元/件 ";
        }
        var html = '<div class="layui-form-item">\n' +
            '                    <label class="layui-form-label"><span style="color:red;">*</span>'+first+'</label>\n' +
            '                    <div class="layui-input-inline">\n' +
            '                        <input type="text" name="first" required lay-verify="required" autocomplete="first"  placeholder="'+first+'" value="{$list[\'first\']}" class="layui-input" >\n' +
            '                    </div>\n' +
            '                </div>\n' +
            '                <div class="layui-form-item">\n' +
            '                    <label class="layui-form-label"><span style="color:red;">*</span>'+first_price+'</label>\n' +
            '                    <div class="layui-input-inline">\n' +
            '                        <input type="text" name="first_price" required lay-verify="required"  autocomplete="first_price"  placeholder="'+first_price_pl+'" value="{$list[\'first_price\']}" class="layui-input" >\n' +
            '                    </div>\n' +
            '                </div>\n' +
            '                <div class="layui-form-item">\n' +
            '                    <label class="layui-form-label"><span style="color:red;">*</span>'+add+'</label>\n' +
            '                    <div class="layui-input-inline">\n' +
            '                        <input type="text" name="add" required lay-verify="required"  autocomplete="add"  placeholder="'+add+'" value="{$list[\'add\']}" class="layui-input" >\n' +
            '                    </div>\n' +
            '                </div>\n' +
            '                <div class="layui-form-item">\n' +
            '                    <label class="layui-form-label"><span style="color:red;">*</span>'+add_price+' </label>\n' +
            '                    <div class="layui-input-inline">\n' +
            '                        <input type="text" name="add_price" required lay-verify="required"  autocomplete="add_price"  placeholder="'+add_price_pl+'" value="{$list[\'add_price\']}" class="layui-input" >\n' +
            '                    </div>\n' +
            '                </div>';
        $('#xianshi').html();
        $('#xianshi').html(html);
    };

    window.onload = function () {
        add_dom({$list['type']});
    };
    layui.use(["form"], function(){
        var layer = layui.layer;
        form = layui.form;

        form.on('radio(jiedian)', function (data) {
            var type = data.value;
            add_dom(type)
        });

        form.on('submit(L_submit)', function(data){
            var formData = data.field;
            var type= formData.type;
            if(formData.type==""|| formData.type==null || formData.type==undefined){
                layer.msg('请选择运费类型！');
                return false;
            }
            $.ajax({
                type : "post",
                url : "/admin/Items/postage_doPost",
                data: formData,
                dataType: 'json',
                success:function(res){
                    if( res.code == 1 ){
                        layer.msg(res.msg); 
                        var index = parent.layer.getFrameIndex(window.name);
                        setTimeout(function(){
                            parent.layer.close(index);
                            parent.location.reload();
                        }, 1000);  
                    }else{
                        layer.msg(res.msg);
                    }
                }
            });
            return false;
        });
        //关闭
        $("#close").click(function(){
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭
            parent.location.reload();
        })
    });
</script>
{/block}