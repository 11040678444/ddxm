{extend name="index_layout"/}
{block name="main"}
<style>
    .readonly{
        background: #5e5e5e;
        color: white;
    }
</style>
<div class="layui-card">
    <div class="layui-card-header">{$data.shop_id}</div>
    <div class="layui-card-body">
        <form class="layui-form form-horizontal">    <!-- action="{:url('admin/Member/level_doPost')}" method="post" -->
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red;">*</span>商品名称 </label>
                <div class="layui-input-inline w300">
                    <input type="text" readonly="readonly" value="{$data.title}" class="layui-input readonly">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red;">*</span>商品条形码 </label>
                <div class="layui-input-inline w300">
                    <input type="text" readonly="readonly" value="{$data.bar_code}" class="layui-input readonly" >
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red;">*</span>当前库存 </label>
                <div class="layui-input-inline w300">
                    <input type="text" id="stock" readonly="readonly" value="{$data.stock}" class="layui-input readonly" >
                </div>
            </div>
<!--            <div class="layui-form-item">-->
<!--                <label class="layui-form-label"><span style="color:red;">*</span>当前进价成本单价 </label>-->
<!--                <div class="layui-input-inline w300">-->
<!--                    <input type="text" readonly="readonly" value="{$data.single_price}" class="layui-input readonly" >-->
<!--                </div>-->
<!--            </div>-->
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red;">*</span>当前进价合计成本 </label>
                <div class="layui-input-inline w300">
                    <input type="text" readonly="readonly" value="{$data.cost_price}" class="layui-input readonly" >
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red;">*</span>当前公司成本单价 </label>
                <div class="layui-input-inline w300">
                    <input type="text" readonly="readonly" value="{$data.gs_single_cost}" class="layui-input readonly" >
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red;">*</span>当前公司合计成本 </label>
                <div class="layui-input-inline w300">
                    <input type="text" readonly="readonly" value="{$data.gs_cost}" class="layui-input readonly" >
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red;">*</span>当前门店成本单价 </label>
                <div class="layui-input-inline w300">
                    <input type="text" readonly="readonly" value="{$data.single_price1}" class="layui-input readonly" >
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red;">*</span>当前门店合计成本 </label>
                <div class="layui-input-inline w300">
                    <input type="text" readonly="readonly" value="{$data.cost_price1}" class="layui-input readonly" >
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red;">*</span>变更门店成本单价 </label>
                <div class="layui-input-inline w300">
                    <input type="text" name="md_one_price" id="md_one_price" autocomplete="off" onkeyup="checkNum(this)" value="" class="layui-input" >
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><span style="color:red;">*</span>变更后门店合计成本 </label>
                <div class="layui-input-inline w300">
                    <input type="text" name="md_all_price" id="md_all_price" readonly="readonly" value="" class="layui-input readonly" >
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">同步门店 <span class="must">*</span></label>
                <div class="layui-input-block">
                    <input type="checkbox" name="all_shop" value="1" lay-skin="primary" title="所有门店" lay-filter="c_all" >
                    <!-- <input type="checkbox"  lay-skin="primary" title="反选" class="f_all"lay-filter="f_all" > -->
                </div>
                <div class="layui-input-block">
                    {volist name="shop" id="vo"}
                    <input type="checkbox" <?php for($i=0;$i<count($list['shop_ids']);$i++){if( $list['shop_ids'][$i] == $vo['id'] ){ echo "checked='checked'"; }} ?> name="shop_ids[]" lay-skin="primary" title="{$vo.name}" class="shop_id" value="{$vo.id}" data="{$vo.id}">
                   
                    {/volist}
                </div>
            </div>
            <input type="hidden" name="item_id" value="{$data['id']}">
            <input type="hidden" name="shop_id" value="{$data['shop_ids']}">
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="L_submit">立即提交</button>
                    <button class="layui-btn layui-btn-normal" id = "close">返回</button>
                </div>
            </div>
        </form>
    </div>
</div>
{/block}
{block name="script"}
<script type="text/javascript" src="__STATIC__/admin/js/common.js"></script>
<script type="text/javascript" src="__STATIC__/admin/js/ticket.js"></script>
<script>

    function checkNum(obj){
        if (isNaN(obj.value)) {
            layer.msg('请输入正确格式');
            obj.value = "";
        }
        if (obj != null) {
            if (obj.value.toString().split(".").length > 1 && obj.value.toString().split(".")[1].length > 2) {
                layer.msg('最多只能保留2位小数点！');
                obj.value = "";
            }
        }
    }
    $(function(){
        //输入框的值改变时触发
        $("#md_one_price").on("input",function(e){
            //获取input输入的值
            let md_one_price = e.delegateTarget.value;      //变更成本单价
            let num = $('#stock').val();
            let md_all_price =(md_one_price*num).toFixed(2);

            $('#md_all_price').val(md_all_price);
        });
    });


    layui.use(["form"], function(){
        var layer = layui.layer;
        form = layui.form;
        form.on('submit(L_submit)', function(data){
            var formData = data.field;
            if ( formData.md_one_price == '' )
            {
                layer.msg('请输入门店成本单价');
                return false;
            }
            $.ajax({
                type : "post",
                url : "/admin/Deposit/edit_cost",
                data: formData,
                dataType: 'json',
                success:function(res){
                    if( res.code == 1 ){
                        layer.msg(res.msg); 
                        var index = parent.layer.getFrameIndex(window.name);
                        setTimeout(function(){
                            parent.layer.close(index);
                            // parent.layui.table.reload('table');
                        }, 1000);  
                    }else{
                        layer.msg(res.msg);
                    }
                }
            });
            return false;
        });
        //关闭
        $("#close").click(function(){
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭
            // parent.location.reload();
        })
    });
</script>
{/block}